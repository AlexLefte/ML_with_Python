{"cells":[{"cell_type":"code","source":["%tensorflow_version 2.x "],"metadata":{"id":"rcIqB-AIpHAT","executionInfo":{"status":"ok","timestamp":1650226404170,"user_tz":-180,"elapsed":4,"user":{"displayName":"Alex Lefterache","userId":"15058845770182448453"}}},"execution_count":1,"outputs":[]},{"cell_type":"markdown","source":["**IMPORTS**"],"metadata":{"id":"1gXUsE6410Cj"}},{"cell_type":"code","source":["from __future__ import absolute_import, division, print_function, unicode_literals\n","\n","import tensorflow as tf\n","import pandas as pd\n","\n","CSV_COLUMN_NAMES = [\"SepalLength\", \"SepalWidth\", \"PetalLength\", \"PetalWidth\", \"Species\"]\n","SPECIES = [\"Setosa\", \"Versicolor\", \"Virginica\"]\n","\n","train_path = tf.keras.utils.get_file(\"iris_training.csv\", \"https://storage.googleapis.com/download.tensorflow.org/data/iris_training.csv\")\n","test_path = tf.keras.utils.get_file(\"iris_test.csv\", \"https://storage.googleapis.com/download.tensorflow.org/data/iris_test.csv\")\n","\n","train = pd.read_csv(train_path, names=CSV_COLUMN_NAMES, header=0)\n","test = pd.read_csv(test_path, names=CSV_COLUMN_NAMES, header=0)\n","\n","# print(train.head())\n","\n","y_train = train.pop('Species')\n","y_test = test.pop('Species')\n","# print(train.head())  # Coloana 'Species' a fost eliminata"],"metadata":{"id":"QIDg8CmE12-J","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1650226409443,"user_tz":-180,"elapsed":5276,"user":{"displayName":"Alex Lefterache","userId":"15058845770182448453"}},"outputId":"4290d36a-fa99-4561-99a7-9bda49c6fc50"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading data from https://storage.googleapis.com/download.tensorflow.org/data/iris_training.csv\n","16384/2194 [================================================================================================================================================================================================================================] - 0s 0us/step\n","Downloading data from https://storage.googleapis.com/download.tensorflow.org/data/iris_test.csv\n","16384/573 [=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================] - 0s 0us/step\n"]}]},{"cell_type":"markdown","source":["**TRAINING**"],"metadata":{"id":"l-0FKjJQom8I"}},{"cell_type":"code","source":["def input_fn(features, labels, training=True, batch_size=256):\n","    dataset = tf.data.Dataset.from_tensor_slices((dict(features), labels))\n","    if training:\n","        dataset = dataset.shuffle(1000).repeat()\n","    return dataset.batch(batch_size)\n","\n","\n","my_feature_columns = []\n","for key in train.keys():\n","    my_feature_columns.append(tf.feature_column.numeric_column(key=key))\n","\n","\n","clf = tf.estimator.DNNClassifier(feature_columns=my_feature_columns, hidden_units=[30, 10], n_classes=3)  # hidden_units\n","# celor doua straturi interne de neuroni\n","\n","clf.train(input_fn=lambda: input_fn(train, y_train, training=True), steps=5000)"],"metadata":{"id":"VOvnvKpMoq6g","executionInfo":{"status":"ok","timestamp":1650226453792,"user_tz":-180,"elapsed":44352,"user":{"displayName":"Alex Lefterache","userId":"15058845770182448453"}},"outputId":"62c211f1-73f5-4995-fdda-7e590d86e585","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["INFO:tensorflow:Using default config.\n","WARNING:tensorflow:Using temporary folder as model directory: /tmp/tmp7ohwj_gm\n","INFO:tensorflow:Using config: {'_model_dir': '/tmp/tmp7ohwj_gm', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true\n","graph_options {\n","  rewrite_options {\n","    meta_optimizer_iterations: ONE\n","  }\n","}\n",", '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_experimental_max_worker_delay_secs': None, '_session_creation_timeout_secs': 7200, '_checkpoint_save_graph_def': True, '_service': None, '_cluster_spec': ClusterSpec({}), '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1}\n","WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/tensorflow/python/training/training_util.py:397: Variable.initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.\n","Instructions for updating:\n","Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.\n","INFO:tensorflow:Calling model_fn.\n","WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/keras/optimizer_v2/adagrad.py:84: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.\n","Instructions for updating:\n","Call initializer instance with the dtype argument instead of passing it to the constructor\n","INFO:tensorflow:Done calling model_fn.\n","INFO:tensorflow:Create CheckpointSaverHook.\n","INFO:tensorflow:Graph was finalized.\n","INFO:tensorflow:Running local_init_op.\n","INFO:tensorflow:Done running local_init_op.\n","INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 0...\n","INFO:tensorflow:Saving checkpoints for 0 into /tmp/tmp7ohwj_gm/model.ckpt.\n","INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 0...\n","INFO:tensorflow:loss = 1.4029516, step = 0\n","INFO:tensorflow:global_step/sec: 172.036\n","INFO:tensorflow:loss = 1.0548031, step = 100 (0.585 sec)\n","INFO:tensorflow:global_step/sec: 200.348\n","INFO:tensorflow:loss = 0.9984272, step = 200 (0.501 sec)\n","INFO:tensorflow:global_step/sec: 158.091\n","INFO:tensorflow:loss = 0.9658798, step = 300 (0.634 sec)\n","INFO:tensorflow:global_step/sec: 204.972\n","INFO:tensorflow:loss = 0.9423691, step = 400 (0.489 sec)\n","INFO:tensorflow:global_step/sec: 207.99\n","INFO:tensorflow:loss = 0.92383975, step = 500 (0.476 sec)\n","INFO:tensorflow:global_step/sec: 171.64\n","INFO:tensorflow:loss = 0.9055116, step = 600 (0.591 sec)\n","INFO:tensorflow:global_step/sec: 180.931\n","INFO:tensorflow:loss = 0.8969344, step = 700 (0.545 sec)\n","INFO:tensorflow:global_step/sec: 185.332\n","INFO:tensorflow:loss = 0.876868, step = 800 (0.544 sec)\n","INFO:tensorflow:global_step/sec: 170.718\n","INFO:tensorflow:loss = 0.86200345, step = 900 (0.581 sec)\n","INFO:tensorflow:global_step/sec: 159.753\n","INFO:tensorflow:loss = 0.84569937, step = 1000 (0.626 sec)\n","INFO:tensorflow:global_step/sec: 128.254\n","INFO:tensorflow:loss = 0.83523417, step = 1100 (0.780 sec)\n","INFO:tensorflow:global_step/sec: 168.738\n","INFO:tensorflow:loss = 0.8209928, step = 1200 (0.594 sec)\n","INFO:tensorflow:global_step/sec: 187.029\n","INFO:tensorflow:loss = 0.8118762, step = 1300 (0.535 sec)\n","INFO:tensorflow:global_step/sec: 168.609\n","INFO:tensorflow:loss = 0.7911481, step = 1400 (0.591 sec)\n","INFO:tensorflow:global_step/sec: 173.111\n","INFO:tensorflow:loss = 0.78484493, step = 1500 (0.578 sec)\n","INFO:tensorflow:global_step/sec: 157.584\n","INFO:tensorflow:loss = 0.770269, step = 1600 (0.641 sec)\n","INFO:tensorflow:global_step/sec: 144.374\n","INFO:tensorflow:loss = 0.75424135, step = 1700 (0.693 sec)\n","INFO:tensorflow:global_step/sec: 131.761\n","INFO:tensorflow:loss = 0.7527763, step = 1800 (0.759 sec)\n","INFO:tensorflow:global_step/sec: 110.233\n","INFO:tensorflow:loss = 0.7407403, step = 1900 (0.912 sec)\n","INFO:tensorflow:global_step/sec: 131.595\n","INFO:tensorflow:loss = 0.7272423, step = 2000 (0.748 sec)\n","INFO:tensorflow:global_step/sec: 156.983\n","INFO:tensorflow:loss = 0.7151697, step = 2100 (0.638 sec)\n","INFO:tensorflow:global_step/sec: 122.061\n","INFO:tensorflow:loss = 0.7131829, step = 2200 (0.819 sec)\n","INFO:tensorflow:global_step/sec: 133.003\n","INFO:tensorflow:loss = 0.69866633, step = 2300 (0.752 sec)\n","INFO:tensorflow:global_step/sec: 184.411\n","INFO:tensorflow:loss = 0.68561345, step = 2400 (0.543 sec)\n","INFO:tensorflow:global_step/sec: 116.396\n","INFO:tensorflow:loss = 0.67941105, step = 2500 (0.865 sec)\n","INFO:tensorflow:global_step/sec: 123.996\n","INFO:tensorflow:loss = 0.67290723, step = 2600 (0.799 sec)\n","INFO:tensorflow:global_step/sec: 136.995\n","INFO:tensorflow:loss = 0.6644025, step = 2700 (0.738 sec)\n","INFO:tensorflow:global_step/sec: 150.77\n","INFO:tensorflow:loss = 0.64724195, step = 2800 (0.656 sec)\n","INFO:tensorflow:global_step/sec: 151.701\n","INFO:tensorflow:loss = 0.6500584, step = 2900 (0.659 sec)\n","INFO:tensorflow:global_step/sec: 134.87\n","INFO:tensorflow:loss = 0.63782346, step = 3000 (0.742 sec)\n","INFO:tensorflow:global_step/sec: 133.876\n","INFO:tensorflow:loss = 0.6370778, step = 3100 (0.751 sec)\n","INFO:tensorflow:global_step/sec: 104.365\n","INFO:tensorflow:loss = 0.62117463, step = 3200 (0.954 sec)\n","INFO:tensorflow:global_step/sec: 142.647\n","INFO:tensorflow:loss = 0.6185947, step = 3300 (0.702 sec)\n","INFO:tensorflow:global_step/sec: 171.984\n","INFO:tensorflow:loss = 0.6201031, step = 3400 (0.582 sec)\n","INFO:tensorflow:global_step/sec: 163.729\n","INFO:tensorflow:loss = 0.60368574, step = 3500 (0.610 sec)\n","INFO:tensorflow:global_step/sec: 163.081\n","INFO:tensorflow:loss = 0.60356605, step = 3600 (0.618 sec)\n","INFO:tensorflow:global_step/sec: 166.51\n","INFO:tensorflow:loss = 0.59585774, step = 3700 (0.602 sec)\n","INFO:tensorflow:global_step/sec: 151.462\n","INFO:tensorflow:loss = 0.584686, step = 3800 (0.659 sec)\n","INFO:tensorflow:global_step/sec: 161.783\n","INFO:tensorflow:loss = 0.5756245, step = 3900 (0.622 sec)\n","INFO:tensorflow:global_step/sec: 141.62\n","INFO:tensorflow:loss = 0.57317615, step = 4000 (0.703 sec)\n","INFO:tensorflow:global_step/sec: 176.024\n","INFO:tensorflow:loss = 0.55605483, step = 4100 (0.574 sec)\n","INFO:tensorflow:global_step/sec: 137.75\n","INFO:tensorflow:loss = 0.56252205, step = 4200 (0.720 sec)\n","INFO:tensorflow:global_step/sec: 148.112\n","INFO:tensorflow:loss = 0.56097966, step = 4300 (0.688 sec)\n","INFO:tensorflow:global_step/sec: 143.503\n","INFO:tensorflow:loss = 0.5585026, step = 4400 (0.680 sec)\n","INFO:tensorflow:global_step/sec: 164.317\n","INFO:tensorflow:loss = 0.5446453, step = 4500 (0.610 sec)\n","INFO:tensorflow:global_step/sec: 123.542\n","INFO:tensorflow:loss = 0.54858744, step = 4600 (0.812 sec)\n","INFO:tensorflow:global_step/sec: 142.085\n","INFO:tensorflow:loss = 0.54324263, step = 4700 (0.697 sec)\n","INFO:tensorflow:global_step/sec: 140.141\n","INFO:tensorflow:loss = 0.5273471, step = 4800 (0.713 sec)\n","INFO:tensorflow:global_step/sec: 163.084\n","INFO:tensorflow:loss = 0.51544905, step = 4900 (0.619 sec)\n","INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 5000...\n","INFO:tensorflow:Saving checkpoints for 5000 into /tmp/tmp7ohwj_gm/model.ckpt.\n","INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 5000...\n","INFO:tensorflow:Loss for final step: 0.5316167.\n"]},{"output_type":"execute_result","data":{"text/plain":["<tensorflow_estimator.python.estimator.canned.dnn.DNNClassifierV2 at 0x7fd1e6bd3cd0>"]},"metadata":{},"execution_count":3}]},{"cell_type":"markdown","source":["**TESTING**"],"metadata":{"id":"IXViIv4sovq2"}},{"cell_type":"code","source":["eval_result = clf.evaluate(input_fn=lambda: input_fn(test, y_test, training=False))\n","print('\\nTest accuracy: {accuracy:0.3f}\\n'.format(**eval_result))"],"metadata":{"id":"A6CQ5mEAox1M","executionInfo":{"status":"ok","timestamp":1650226485907,"user_tz":-180,"elapsed":1656,"user":{"displayName":"Alex Lefterache","userId":"15058845770182448453"}},"outputId":"06dc7947-aa7a-42e1-998f-beba3ca88df3","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":4,"outputs":[{"output_type":"stream","name":"stdout","text":["INFO:tensorflow:Calling model_fn.\n","INFO:tensorflow:Done calling model_fn.\n","INFO:tensorflow:Starting evaluation at 2022-04-17T20:14:43\n","INFO:tensorflow:Graph was finalized.\n","INFO:tensorflow:Restoring parameters from /tmp/tmp7ohwj_gm/model.ckpt-5000\n","INFO:tensorflow:Running local_init_op.\n","INFO:tensorflow:Done running local_init_op.\n","INFO:tensorflow:Inference Time : 0.87962s\n","INFO:tensorflow:Finished evaluation at 2022-04-17-20:14:44\n","INFO:tensorflow:Saving dict for global step 5000: accuracy = 0.8333333, average_loss = 0.5921108, global_step = 5000, loss = 0.5921108\n","INFO:tensorflow:Saving 'checkpoint_path' summary for global step 5000: /tmp/tmp7ohwj_gm/model.ckpt-5000\n","\n","Test accuracy: 0.833\n","\n"]}]},{"cell_type":"markdown","source":["\n","**PREDICTIE DATA DE LA TASTATURA**\n"],"metadata":{"id":"3qRwGDiup5sW"}},{"cell_type":"code","source":["from tensorflow.python.ops.gen_batch_ops import batch\n","def input_fn(features, batch_size=256):\n","  return tf.data.Dataset.from_tensor_slices(dict(features)).batch(batch_size)  \n","\n","features = ['SepalLength', 'SepalWidth', 'PetalLength', 'PetalWidth']\n","predict = {}\n","\n","print(\"Introduceti valorile cerute in format de tip float: \")\n","for feature in features:\n","  valid = True\n","  while valid:\n","    val = input(feature + ':')\n","    if not val.isdigit():\n","      valid = False\n","  predict[feature] = [float(val)]\n","\n","\n","predictions = clf.predict(input_fn=lambda: input_fn(predict))\n","for pred_dict in predictions:\n","  print(pred_dict)\n","  class_id = pred_dict['class_ids'][0]\n","  probability = pred_dict['probabilities'][class_id]\n","  print('Prediction is \"{}\" ({:.1f}%)'.format(SPECIES[class_id], 100*probability))\n","    "],"metadata":{"id":"ENKRx5kTp5Ic","executionInfo":{"status":"ok","timestamp":1650226626991,"user_tz":-180,"elapsed":10665,"user":{"displayName":"Alex Lefterache","userId":"15058845770182448453"}},"outputId":"2228c81e-d33e-467b-c317-f80b7a47dd55","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["Introduceti valorile cerute in format de tip float: \n","SepalLength:3\n","SepalLength:2.3\n","SepalWidth:4.2\n","PetalLength:1.5\n","PetalWidth:3.4\n","INFO:tensorflow:Calling model_fn.\n","INFO:tensorflow:Done calling model_fn.\n","INFO:tensorflow:Graph was finalized.\n","INFO:tensorflow:Restoring parameters from /tmp/tmp7ohwj_gm/model.ckpt-5000\n","INFO:tensorflow:Running local_init_op.\n","INFO:tensorflow:Done running local_init_op.\n","{'logits': array([-1.5756687, -1.9442608, -1.0200443], dtype=float32), 'probabilities': array([0.29114318, 0.2013859 , 0.50747097], dtype=float32), 'class_ids': array([2]), 'classes': array([b'2'], dtype=object), 'all_class_ids': array([0, 1, 2], dtype=int32), 'all_classes': array([b'0', b'1', b'2'], dtype=object)}\n","Prediction is \"Virginica\" (50.7%)\n"]}]}],"metadata":{"colab":{"collapsed_sections":[],"name":"IRIS_DATASET","toc_visible":true,"provenance":[{"file_id":"/v2/external/notebooks/intro.ipynb","timestamp":1648056765716}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}